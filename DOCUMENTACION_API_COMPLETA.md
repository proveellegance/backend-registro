# üìö DOCUMENTACI√ìN COMPLETA DE APIS - BACKEND REGISTRO

## üåê Informaci√≥n General

### URL Base
```
https://backend-registro-sa7u.onrender.com
```

### Autenticaci√≥n
**Todas las APIs requieren autenticaci√≥n por Token**
```
Headers: {
  "Authorization": "Token dcdf8b68bff6fb1a4c48b4d0c7e1a77b73a2f8ff",
  "Content-Type": "application/json"
}
```

### Formato de Respuesta
- **√âxito**: Status 200/201 con datos JSON
- **Error**: Status 400/401/404/500 con mensaje de error
- **Paginaci√≥n**: Incluye `count`, `next`, `previous`, `results`

---

## üìã CONTROL DE GESTI√ìN - `/api/control-gestion/`

### 1. üìÅ EXPEDIENTES - `/expedientes/`

#### **GET /api/control-gestion/expedientes/**
Lista todos los expedientes con paginaci√≥n
```json
{
  "count": 250,
  "next": "https://backend-registro-sa7u.onrender.com/api/control-gestion/expedientes/?page=2",
  "previous": null,
  "results": [
    {
      "id": 1,
      "solicitud": "EXP-001",
      "numeros_registro": "12345",
      "num_reco_carpeta": "RC-001",
      "ubicacion": "Archivo Central",
      "hecho_victimizante": "Descripci√≥n del hecho",
      "estatus": "Activo",
      "resguardo": "Juan P√©rez",
      "notas": "Observaciones",
      "fecha_turno_cie": "2025-01-15",
      "fecha_creacion": "2025-01-15T10:30:00Z",
      "fecha_actualizacion": "2025-01-15T10:30:00Z"
    }
  ]
}
```

#### **Filtros Disponibles:**
- `?estatus=Activo` - Filtrar por estatus
- `?resguardo=Juan P√©rez` - Filtrar por responsable
- `?search=EXP-001` - B√∫squeda en solicitud, n√∫meros, ubicaci√≥n, hecho, notas
- `?ordering=-fecha_creacion` - Ordenar por fecha (- para descendente)
- `?page=2&page_size=20` - Paginaci√≥n

#### **GET /api/control-gestion/expedientes/{id}/**
Obtiene un expediente espec√≠fico

#### **POST /api/control-gestion/expedientes/**
Crear nuevo expediente
```json
{
  "solicitud": "EXP-002",
  "numeros_registro": "12346",
  "estatus": "Activo",
  "resguardo": "Mar√≠a Garc√≠a"
}
```

#### **PUT/PATCH /api/control-gestion/expedientes/{id}/**
Actualizar expediente (PUT = completo, PATCH = parcial)

#### **DELETE /api/control-gestion/expedientes/{id}/**
Eliminar expediente

#### **GET /api/control-gestion/expedientes/estadisticas/**
Estad√≠sticas de expedientes
```json
{
  "total_expedientes": 250,
  "por_estatus": [
    {"estatus": "Activo", "cantidad": 200},
    {"estatus": "Cerrado", "cantidad": 50}
  ],
  "por_resguardo": [
    {"resguardo": "Juan P√©rez", "cantidad": 100},
    {"resguardo": "Mar√≠a Garc√≠a", "cantidad": 75}
  ]
}
```

---

### 2. üîÑ TURNO CIE - `/turno-cie/`

#### **GET /api/control-gestion/turno-cie/**
Lista todos los turnos CIE
```json
{
  "count": 180,
  "results": [
    {
      "id": 1,
      "num_registro": "TC-001",
      "num_sol": "SOL-001",
      "tipo": "Urgente",
      "usuaria": "Cliente A",
      "victimas_relacionadas": "3 v√≠ctimas",
      "oficio_salida": "OF-001",
      "anio": "2025",
      "fecha_recepcion_cie": "2025-01-15",
      "fecha_creacion": "2025-01-15T10:30:00Z",
      "fecha_actualizacion": "2025-01-15T10:30:00Z"
    }
  ]
}
```

#### **Filtros Disponibles:**
- `?tipo=Urgente` - Filtrar por tipo
- `?usuaria=Cliente A` - Filtrar por usuaria
- `?anio=2025` - Filtrar por a√±o
- `?search=TC-001` - B√∫squeda en registro, solicitud, v√≠ctimas, oficio

#### **GET /api/control-gestion/turno-cie/estadisticas/**
```json
{
  "total_turnos": 180,
  "por_tipo": [
    {"tipo": "Urgente", "cantidad": 120},
    {"tipo": "Normal", "cantidad": 60}
  ],
  "por_usuaria": [
    {"usuaria": "Cliente A", "cantidad": 50}
  ]
}
```

---

### 3. üìù SOLICITUDES REGISTRO - `/solicitudes-registro/`

#### **GET /api/control-gestion/solicitudes-registro/**
Lista solicitudes de registro
```json
{
  "count": 320,
  "results": [
    {
      "id": 1,
      "numero_solicitud": "SR-001",
      "solicitante": "Juan P√©rez",
      "persona_usuaria": "Mar√≠a Garc√≠a",
      "delito": "Descripci√≥n del delito",
      "curp": "JUPD850315HDFXXX01",
      "solicitud": "Descripci√≥n de la solicitud",
      "estatus_solicitud": "En proceso",
      "tipo_resolucion": "Favorable",
      "aceptacion": "S√≠",
      "anio": "2025",
      "fecha_solicitud": "2025-01-15",
      "fecha_resolucion": "2025-01-20",
      "fecha_creacion": "2025-01-15T10:30:00Z",
      "fecha_actualizacion": "2025-01-15T10:30:00Z"
    }
  ]
}
```

#### **Filtros Disponibles:**
- `?estatus_solicitud=En proceso`
- `?tipo_resolucion=Favorable`
- `?aceptacion=S√≠`
- `?anio=2025`
- `?search=SR-001` - B√∫squeda en n√∫mero, solicitante, persona, delito, CURP

#### **GET /api/control-gestion/solicitudes-registro/estadisticas/**
```json
{
  "total_solicitudes": 320,
  "por_estatus": [
    {"estatus_solicitud": "En proceso", "cantidad": 150}
  ],
  "por_tipo_resolucion": [
    {"tipo_resolucion": "Favorable", "cantidad": 200}
  ],
  "por_aceptacion": [
    {"aceptacion": "S√≠", "cantidad": 280}
  ]
}
```

---

### 4. üì§ OFICIOS SALIDA - `/oficios-salida/`

#### **GET /api/control-gestion/oficios-salida/**
Lista oficios de salida
```json
{
  "count": 450,
  "results": [
    {
      "id": 1,
      "numero_oficio": "OS-001",
      "alfanumerica_oficio": "OS-2025-001",
      "fecha": "2025-01-15",
      "solicitante": "Dependencia A",
      "destinatario": "Instituci√≥n B",
      "asunto": "Solicitud de informaci√≥n",
      "tipo_envio": "F√≠sico",
      "anio": "2025",
      "fecha_creacion": "2025-01-15T10:30:00Z",
      "fecha_actualizacion": "2025-01-15T10:30:00Z"
    }
  ]
}
```

#### **Filtros Disponibles:**
- `?tipo_envio=F√≠sico`
- `?anio=2025`
- `?search=OS-001` - B√∫squeda en n√∫mero, alfanum√©rica, solicitante, destinatario, asunto

#### **GET /api/control-gestion/oficios-salida/estadisticas/**
```json
{
  "total_oficios": 450,
  "por_tipo_envio": [
    {"tipo_envio": "F√≠sico", "cantidad": 300},
    {"tipo_envio": "Digital", "cantidad": 150}
  ],
  "por_solicitante": [
    {"solicitante": "Dependencia A", "cantidad": 100}
  ]
}
```

---

### 5. üì• OFICIOS ENTRADA - `/oficios-entrada/` ‚≠ê **CON ARCHIVOS PDF**

#### **GET /api/control-gestion/oficios-entrada/**
Lista oficios de entrada (CON FUNCIONALIDAD PDF)
```json
{
  "count": 1501,
  "results": [
    {
      "id": 3597,
      "numero": "429",
      "alfanumerica_entrada": "OE-2025-429",
      "entrada": "Entrada_429",
      "remitente": "Instituci√≥n X",
      "autoridad_dependencia": "SEDENA",
      "asunto": "Solicitud de informaci√≥n",
      "formato": "PDF",
      "anio": "2025",
      "archivo": "oficios_entrada/Entrada_429.pdf",
      "archivo_url": "https://backend-registro-sa7u.onrender.com/media/oficios_entrada/Entrada_429.pdf",
      "archivo_nombre": "Entrada_429.pdf",
      "tiene_archivo": true,
      "fecha_creacion": "2025-01-15T10:30:00Z",
      "fecha_actualizacion": "2025-01-15T10:30:00Z"
    }
  ]
}
```

#### **Filtros Especiales PDF:**
- `?tiene_archivo=true` - Solo oficios con PDF
- `?tiene_archivo=false` - Solo oficios sin PDF
- `?autoridad_dependencia=SEDENA`
- `?formato=PDF`
- `?anio=2025`
- `?search=Entrada_429` - B√∫squeda en todos los campos texto

#### **GET /api/control-gestion/oficios-entrada/estadisticas/**
Estad√≠sticas completas con informaci√≥n de archivos
```json
{
  "total_oficios": 1501,
  "con_archivo": 1501,
  "sin_archivo": 0,
  "porcentaje_con_archivo": 100.0,
  "por_autoridad": [
    {"autoridad_dependencia": "SEDENA", "cantidad": 500},
    {"autoridad_dependencia": "SEMAR", "cantidad": 300}
  ],
  "por_formato": [
    {"formato": "PDF", "cantidad": 1400},
    {"formato": "F√≠sico", "cantidad": 101}
  ],
  "por_anio": [
    {
      "anio": "2025",
      "total": 587,
      "con_pdf": 587
    },
    {
      "anio": "2024", 
      "total": 910,
      "con_pdf": 910
    }
  ]
}
```

#### **GET /api/control-gestion/oficios-entrada/con_archivos/**
Solo oficios que tienen archivos PDF
```json
{
  "count": 1501,
  "results": [
    {
      "id": 3597,
      "entrada": "Entrada_429",
      "archivo_url": "https://backend-registro-sa7u.onrender.com/media/oficios_entrada/Entrada_429.pdf",
      "archivo_nombre": "Entrada_429.pdf",
      "tiene_archivo": true,
      // ... resto de campos
    }
  ]
}
```

#### **GET /api/control-gestion/oficios-entrada/sin_archivos/**
Solo oficios que NO tienen archivos PDF
```json
{
  "count": 0,
  "results": []
}
```

#### **GET /api/control-gestion/oficios-entrada/{id}/descargar_pdf/**
Descarga directa del archivo PDF
- **Respuesta**: Archivo PDF binario
- **Headers**: `Content-Disposition: attachment; filename="Entrada_429.pdf"`
- **Content-Type**: `application/pdf`

#### **Casos de uso Frontend:**
```javascript
// 1. Mostrar lista con iconos PDF
const oficios = await api.get('/oficios-entrada/?anio=2025');
oficios.results.forEach(oficio => {
  if (oficio.tiene_archivo) {
    // Mostrar icono PDF
    // Habilitar bot√≥n de descarga
  }
});

// 2. Descargar PDF
const descargarPDF = async (id) => {
  const response = await fetch(`/oficios-entrada/${id}/descargar_pdf/`, {
    headers: { 'Authorization': 'Token ...' }
  });
  const blob = await response.blob();
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'documento.pdf';
  a.click();
};

// 3. Filtrar por archivos
const conArchivos = await api.get('/oficios-entrada/con_archivos/');
const sinArchivos = await api.get('/oficios-entrada/sin_archivos/');
```

---

### 6. üì¢ NOTIFICACIONES - `/notificaciones/`

#### **GET /api/control-gestion/notificaciones/**
Lista notificaciones
```json
{
  "count": 200,
  "results": [
    {
      "id": 1,
      "persona_notificada": "Juan P√©rez",
      "nucleo_familiar": "Familia P√©rez",
      "delito_recomendacion": "Descripci√≥n del delito",
      "funcionario_notifico": "Mar√≠a Garc√≠a",
      "lugar_notificacion": "Oficina Central",
      "fecha": "2025-01-15",
      "fecha_creacion": "2025-01-15T10:30:00Z",
      "fecha_actualizacion": "2025-01-15T10:30:00Z"
    }
  ]
}
```

#### **Filtros Disponibles:**
- `?funcionario_notifico=Mar√≠a Garc√≠a`
- `?search=Juan` - B√∫squeda en persona, n√∫cleo, delito, funcionario, lugar

#### **GET /api/control-gestion/notificaciones/estadisticas/**
```json
{
  "total_notificaciones": 200,
  "por_funcionario": [
    {"funcionario_notifico": "Mar√≠a Garc√≠a", "cantidad": 80}
  ],
  "por_lugar": [
    {"lugar_notificacion": "Oficina Central", "cantidad": 120}
  ]
}
```

---

## üë• USUARIOS - `/api/usuarios/`

### **GET /api/usuarios/perfil/**
Perfil del usuario autenticado
```json
{
  "id": 1,
  "username": "admin",
  "email": "admin@example.com",
  "first_name": "Admin",
  "last_name": "Sistema",
  "is_staff": true,
  "is_active": true,
  "date_joined": "2025-01-01T00:00:00Z"
}
```

---

## üìä PADR√ìN V√çCTIMAS - `/api/padron-victimas/`

### **GET /api/padron-victimas/victimas/**
Lista v√≠ctimas en el padr√≥n
```json
{
  "count": 500,
  "results": [
    {
      "id": 1,
      "nombre_completo": "Ana Garc√≠a L√≥pez",
      "curp": "GALA850315MDFXXX01",
      "numero_registro": "REG-001",
      "fecha_registro": "2025-01-15",
      "estatus": "Activo",
      "municipio": "Ciudad de M√©xico",
      "localidad": "Centro",
      "hechos_victimizantes": "Descripci√≥n",
      "fecha_creacion": "2025-01-15T10:30:00Z"
    }
  ]
}
```

#### **Filtros Disponibles:**
- `?estatus=Activo`
- `?municipio=Ciudad de M√©xico`
- `?search=Ana Garc√≠a` - B√∫squeda en nombre, CURP, n√∫mero registro

---

## üöÄ CASOS DE USO PARA FRONTEND

### 1. **Dashboard Principal**
```javascript
// Obtener estad√≠sticas generales
const expedientes = await api.get('/control-gestion/expedientes/estadisticas/');
const oficios = await api.get('/control-gestion/oficios-entrada/estadisticas/');
const solicitudes = await api.get('/control-gestion/solicitudes-registro/estadisticas/');

// Mostrar m√©tricas:
// - Total de expedientes: expedientes.total_expedientes
// - Oficios con PDF: oficios.porcentaje_con_archivo
// - Solicitudes pendientes: solicitudes.por_estatus
```

### 2. **B√∫squeda Unificada**
```javascript
// B√∫squeda en todos los m√≥dulos
const searchTerm = "TC-001";
const results = await Promise.all([
  api.get(`/control-gestion/expedientes/?search=${searchTerm}`),
  api.get(`/control-gestion/turno-cie/?search=${searchTerm}`),
  api.get(`/control-gestion/oficios-entrada/?search=${searchTerm}`)
]);
```

### 3. **Gesti√≥n de Archivos PDF**
```javascript
// Lista con indicadores PDF
const oficios = await api.get('/control-gestion/oficios-entrada/?anio=2025');

// Filtrar solo con archivos
const conPDF = await api.get('/control-gestion/oficios-entrada/con_archivos/');

// Descarga directa
const downloadPDF = (id) => {
  window.open(`/api/control-gestion/oficios-entrada/${id}/descargar_pdf/`);
};
```

### 4. **Filtros Avanzados**
```javascript
// Combinaci√≥n de filtros
const filtros = {
  anio: '2025',
  tiene_archivo: 'true',
  autoridad_dependencia: 'SEDENA',
  page: 1,
  page_size: 20
};

const query = new URLSearchParams(filtros).toString();
const resultados = await api.get(`/control-gestion/oficios-entrada/?${query}`);
```

---

## ‚ö° CONSIDERACIONES T√âCNICAS

### **Paginaci√≥n**
- Usar `page` y `page_size` en query params
- Respuesta incluye `count`, `next`, `previous`, `results`

### **Autenticaci√≥n**
- Token requerido en header: `Authorization: Token xxx`
- Error 401 si token inv√°lido

### **Manejo de Errores**
```javascript
try {
  const response = await api.get('/control-gestion/expedientes/');
} catch (error) {
  if (error.status === 401) {
    // Redirect to login
  } else if (error.status === 404) {
    // Resource not found
  }
}
```

### **Optimizaci√≥n**
- Usar filtros para reducir datos transferidos
- Implementar cache en frontend para estad√≠sticas
- Paginaci√≥n para listas grandes

---

## üéØ ENDPOINTS PRIORITARIOS PARA FRONTEND

### **Alta Prioridad:**
1. `GET /control-gestion/oficios-entrada/` (con funcionalidad PDF)
2. `GET /control-gestion/oficios-entrada/estadisticas/`
3. `GET /control-gestion/expedientes/`
4. `GET /control-gestion/expedientes/estadisticas/`

### **Media Prioridad:**
1. `GET /control-gestion/solicitudes-registro/`
2. `GET /control-gestion/turno-cie/`
3. `GET /control-gestion/notificaciones/`

### **Baja Prioridad:**
1. `GET /control-gestion/oficios-salida/`
2. `GET /padron-victimas/victimas/`

---

**¬°Toda la documentaci√≥n est√° lista para ser utilizada por el agente de IA del frontend!** üéâ
